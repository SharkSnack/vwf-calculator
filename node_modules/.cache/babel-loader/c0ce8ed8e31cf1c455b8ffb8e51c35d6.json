{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/tay/Sites/vwf-calculator/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _classCallCheck from\"/Users/tay/Sites/vwf-calculator/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/tay/Sites/vwf-calculator/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/tay/Sites/vwf-calculator/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/tay/Sites/vwf-calculator/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import ReactDOM from'react-dom';import'./index.css';import shiren2Widths from'./json/shiren2.json';import shiren4Widths from'./json/shiren4.json';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Preview=/*#__PURE__*/function(_React$Component){_inherits(Preview,_React$Component);var _super=_createSuper(Preview);function Preview(){_classCallCheck(this,Preview);return _super.apply(this,arguments);}_createClass(Preview,[{key:\"renderPreview\",value:function renderPreview(){var html=[];// Shiren 4+ (PSP)\nif(this.props.game==='shiren4'){var _iterator=_createForOfIteratorHelper(this.props.text),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var char=_step.value;if(char==='\\n'){html.push(\"<br/>\");// Lines after the first have 4 spaces of indentation\nfor(var i=0;i<4;i++){html.push(\"<img class=\\\"glyph\\\" src=\\\"./font/shiren4/32.png\\\" />\");}}else{html.push(\"<img class=\\\"glyph\\\" src=\\\"./font/shiren4/\".concat(char.charCodeAt(0),\".png\\\" />\"));}}}catch(err){_iterator.e(err);}finally{_iterator.f();}}return html.join('\\n');}},{key:\"render\",value:function render(){if(this.props.game==='shiren4'){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Preview:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"shiren4Preview\",dangerouslySetInnerHTML:{__html:this.renderPreview()}})]});}else{return null;}}}]);return Preview;}(React.Component);var VWFCalc=/*#__PURE__*/function(_React$Component2){_inherits(VWFCalc,_React$Component2);var _super2=_createSuper(VWFCalc);function VWFCalc(props){var _this;_classCallCheck(this,VWFCalc);_this=_super2.call(this,props);_this.state={game:\"\",textArea:\"\",charCount:0,lookupObj:{},widths:[]};return _this;}_createClass(VWFCalc,[{key:\"handlePresetClick\",value:function handlePresetClick(game){var lookupObj={};switch(game){case'shiren2':lookupObj=shiren2Widths;break;case'shiren4':lookupObj=shiren4Widths;break;default:// empty object\n}this.setState({game:game,lookupObj:lookupObj});}},{key:\"handleFileUpload\",value:function handleFileUpload(event){var _this2=this;var reader=new FileReader();reader.readAsText(event.target.files[0],\"UTF-8\");reader.onload=function(e){try{_this2.setState({lookupObj:JSON.parse(e.target.result)});}catch(e){alert(\"Error parsing widths file.\\n\\nIs it in JSON format?\");}};this.setState({game:\"\"});}},{key:\"handleTextAreaChange\",value:function handleTextAreaChange(event){function calcLineWidth(game,lookupObj,line){var width=0;if(game==='shiren2'){width=4;// starts with 4 pixels padding\nvar _iterator2=_createForOfIteratorHelper(line),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var char=_step2.value;width+=lookupObj[char]+2;// 2 pixels between each character\n}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}if(width>4){width-=2;// last character doesn't have 2 pixels padding\n}else{width=0;// set width to 0 if there are no characters\n}}else{var _iterator3=_createForOfIteratorHelper(line),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _char=_step3.value;width+=lookupObj[_char];}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}return width;}function checkWidthLimit(widths,game,lookupObj){if(game==='shiren2'){for(var i=0;i<widths.length;i++){if(widths[i]>lookupObj[\"_window\"]){widths[i]=\"[Too long!]\";}}}}// recalculate widths\nvar lines=event.target.value.split('\\n');var widths=[];var _iterator4=_createForOfIteratorHelper(lines),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var line=_step4.value;widths.push(calcLineWidth(this.state.game,this.state.lookupObj,line));}// Warn for lines that are too long\n}catch(err){_iterator4.e(err);}finally{_iterator4.f();}checkWidthLimit(widths,this.state.game,this.state.lookupObj);this.setState({textArea:event.target.value,charCount:event.target.value.length,widths:widths});}},{key:\"render\",value:function render(){var _this3=this;var game=this.state.game;var text=this.state.textArea;var charCount=this.state.charCount;var widths=this.state.widths.join('\\n');return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:\"- Variable Width Font Calculator (v1.0) -\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Preset: \"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return _this3.handlePresetClick(\"shiren2\");},children:\"Shiren 2\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return _this3.handlePresetClick(\"shiren4\");},children:\"Shiren 4\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{children:\"Custom: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:function onChange(e){return _this3.handleFileUpload(e);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"textarea\",{cols:\"56\",rows:\"10\",onChange:function onChange(e){return _this3.handleTextAreaChange(e);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Preview,{text:text,game:game}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Result (\",/*#__PURE__*/_jsx(\"span\",{children:charCount}),\" chars):\"]}),/*#__PURE__*/_jsx(\"pre\",{className:\"widthResult\",children:widths})]});}}]);return VWFCalc;}(React.Component);ReactDOM.render(/*#__PURE__*/_jsx(VWFCalc,{}),document.getElementById('root'));","map":{"version":3,"sources":["/Users/tay/Sites/vwf-calculator/src/index.js"],"names":["React","ReactDOM","shiren2Widths","shiren4Widths","Preview","html","props","game","text","char","push","i","charCodeAt","join","__html","renderPreview","Component","VWFCalc","state","textArea","charCount","lookupObj","widths","setState","event","reader","FileReader","readAsText","target","files","onload","e","JSON","parse","result","alert","calcLineWidth","line","width","checkWidthLimit","length","lines","value","split","handlePresetClick","handleFileUpload","handleTextAreaChange","render","document","getElementById"],"mappings":"svBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,WAArB,CACA,MAAO,aAAP,CACA,MAAOC,CAAAA,aAAP,KAA0B,qBAA1B,CACA,MAAOC,CAAAA,aAAP,KAA0B,qBAA1B,C,2FAEMC,CAAAA,O,qPACJ,wBAAgB,CACd,GAAIC,CAAAA,IAAI,CAAG,EAAX,CAEA;AACA,GAAI,KAAKC,KAAL,CAAWC,IAAX,GAAoB,SAAxB,CAAmC,0CACd,KAAKD,KAAL,CAAWE,IADG,YACjC,+CAAoC,IAAzBC,CAAAA,IAAyB,aAClC,GAAIA,IAAI,GAAK,IAAb,CAAmB,CACjBJ,IAAI,CAACK,IAAL,UACA;AACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG,CAApB,CAAuBA,CAAC,EAAxB,CAA4B,CAC1BN,IAAI,CAACK,IAAL,0DACD,CACF,CAND,IAMO,CACLL,IAAI,CAACK,IAAL,qDAAoDD,IAAI,CAACG,UAAL,CAAgB,CAAhB,CAApD,eACD,CACF,CAXgC,qDAYlC,CAED,MAAOP,CAAAA,IAAI,CAACQ,IAAL,CAAU,IAAV,CAAP,CACD,C,sBAED,iBAAS,CACP,GAAI,KAAKP,KAAL,CAAWC,IAAX,GAAoB,SAAxB,CAAmC,CACjC,mBACE,oCACE,+BADF,cAEE,YAAK,SAAS,CAAC,gBAAf,CAAgC,uBAAuB,CAAE,CAACO,MAAM,CAAE,KAAKC,aAAL,EAAT,CAAzD,EAFF,GADF,CAMD,CAPD,IAOO,CACL,MAAO,KAAP,CACD,CACF,C,qBAjCmBf,KAAK,CAACgB,S,KAoCtBC,CAAAA,O,iHACJ,iBAAYX,KAAZ,CAAmB,yCACjB,wBAAMA,KAAN,EACA,MAAKY,KAAL,CAAa,CACXX,IAAI,CAAE,EADK,CAEXY,QAAQ,CAAE,EAFC,CAGXC,SAAS,CAAE,CAHA,CAIXC,SAAS,CAAE,EAJA,CAKXC,MAAM,CAAE,EALG,CAAb,CAFiB,aASlB,C,qDAED,2BAAkBf,IAAlB,CAAwB,CACtB,GAAIc,CAAAA,SAAS,CAAG,EAAhB,CACA,OAAOd,IAAP,EACE,IAAK,SAAL,CACEc,SAAS,CAAGnB,aAAZ,CACA,MACF,IAAK,SAAL,CACEmB,SAAS,CAAGlB,aAAZ,CACA,MACF,QACE;AARJ,CAUA,KAAKoB,QAAL,CAAc,CACZhB,IAAI,CAAEA,IADM,CAEZc,SAAS,CAAEA,SAFC,CAAd,EAID,C,gCAED,0BAAiBG,KAAjB,CAAwB,iBACtB,GAAMC,CAAAA,MAAM,CAAG,GAAIC,CAAAA,UAAJ,EAAf,CACAD,MAAM,CAACE,UAAP,CAAkBH,KAAK,CAACI,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAAlB,CAAyC,OAAzC,EACAJ,MAAM,CAACK,MAAP,CAAgB,SAAAC,CAAC,CAAI,CACnB,GAAI,CACF,MAAI,CAACR,QAAL,CAAc,CACZF,SAAS,CAAEW,IAAI,CAACC,KAAL,CAAWF,CAAC,CAACH,MAAF,CAASM,MAApB,CADC,CAAd,EAGD,CAAC,MAAMH,CAAN,CAAS,CACTI,KAAK,CAAC,qDAAD,CAAL,CACD,CACF,CARD,CASA,KAAKZ,QAAL,CAAc,CACZhB,IAAI,CAAE,EADM,CAAd,EAGD,C,oCAED,8BAAqBiB,KAArB,CAA4B,CAE1B,QAASY,CAAAA,aAAT,CAAuB7B,IAAvB,CAA6Bc,SAA7B,CAAwCgB,IAAxC,CAA8C,CAC5C,GAAIC,CAAAA,KAAK,CAAG,CAAZ,CACA,GAAI/B,IAAI,GAAK,SAAb,CAAwB,CACtB+B,KAAK,CAAG,CAAR,CAAW;AADW,0CAEHD,IAFG,aAEtB,kDAAyB,IAAd5B,CAAAA,IAAc,cACvB6B,KAAK,EAAIjB,SAAS,CAACZ,IAAD,CAAT,CAAkB,CAA3B,CAA8B;AAC/B,CAJqB,uDAKtB,GAAI6B,KAAK,CAAG,CAAZ,CAAe,CACbA,KAAK,EAAI,CAAT,CAAY;AACb,CAFD,IAEO,CACLA,KAAK,CAAG,CAAR,CAAW;AACZ,CACF,CAVD,IAUO,2CACcD,IADd,aACL,kDAAyB,IAAd5B,CAAAA,KAAc,cACvB6B,KAAK,EAAIjB,SAAS,CAACZ,KAAD,CAAlB,CACD,CAHI,uDAIN,CACD,MAAO6B,CAAAA,KAAP,CACD,CACD,QAASC,CAAAA,eAAT,CAAyBjB,MAAzB,CAAiCf,IAAjC,CAAuCc,SAAvC,CAAkD,CAChD,GAAId,IAAI,GAAK,SAAb,CAAwB,CACtB,IAAK,GAAII,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGW,MAAM,CAACkB,MAA3B,CAAmC7B,CAAC,EAApC,CAAwC,CACtC,GAAIW,MAAM,CAACX,CAAD,CAAN,CAAYU,SAAS,CAAC,SAAD,CAAzB,CAAsC,CACpCC,MAAM,CAACX,CAAD,CAAN,CAAY,aAAZ,CACD,CACF,CACF,CACF,CACD;AACA,GAAI8B,CAAAA,KAAK,CAAGjB,KAAK,CAACI,MAAN,CAAac,KAAb,CAAmBC,KAAnB,CAAyB,IAAzB,CAAZ,CACA,GAAIrB,CAAAA,MAAM,CAAG,EAAb,CAhC0B,0CAkCPmB,KAlCO,aAkC1B,kDAA0B,IAAfJ,CAAAA,IAAe,cACxBf,MAAM,CAACZ,IAAP,CAAa0B,aAAa,CAAC,KAAKlB,KAAL,CAAWX,IAAZ,CAAkB,KAAKW,KAAL,CAAWG,SAA7B,CAAwCgB,IAAxC,CAA1B,EACD,CACD;AArC0B,uDAsC1BE,eAAe,CAACjB,MAAD,CAAS,KAAKJ,KAAL,CAAWX,IAApB,CAA0B,KAAKW,KAAL,CAAWG,SAArC,CAAf,CAEA,KAAKE,QAAL,CAAc,CACZJ,QAAQ,CAAEK,KAAK,CAACI,MAAN,CAAac,KADX,CAEZtB,SAAS,CAAEI,KAAK,CAACI,MAAN,CAAac,KAAb,CAAmBF,MAFlB,CAGZlB,MAAM,CAAEA,MAHI,CAAd,EAKD,C,sBAED,iBAAS,iBACP,GAAMf,CAAAA,IAAI,CAAG,KAAKW,KAAL,CAAWX,IAAxB,CACA,GAAMC,CAAAA,IAAI,CAAG,KAAKU,KAAL,CAAWC,QAAxB,CACA,GAAMC,CAAAA,SAAS,CAAG,KAAKF,KAAL,CAAWE,SAA7B,CACA,GAAME,CAAAA,MAAM,CAAG,KAAKJ,KAAL,CAAWI,MAAX,CAAkBT,IAAlB,CAAuB,IAAvB,CAAf,CAEA,mBACE,oCACE,iEADF,cAEE,kCAFF,cAGI,eAAQ,OAAO,CAAE,yBAAM,CAAA,MAAI,CAAC+B,iBAAL,CAAuB,SAAvB,CAAN,EAAjB,sBAHJ,cAII,eAAQ,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACA,iBAAL,CAAuB,SAAvB,CAAN,EAAjB,sBAJJ,cAKI,aALJ,cAME,kCANF,cAOI,cAAO,IAAI,CAAC,MAAZ,CAAmB,QAAQ,CAAE,kBAACb,CAAD,QAAO,CAAA,MAAI,CAACc,gBAAL,CAAsBd,CAAtB,CAAP,EAA7B,EAPJ,cAQI,aARJ,cASI,aATJ,cAUE,iBAAU,IAAI,CAAC,IAAf,CAAoB,IAAI,CAAC,IAAzB,CAA8B,QAAQ,CAAE,kBAACA,CAAD,QAAO,CAAA,MAAI,CAACe,oBAAL,CAA0Bf,CAA1B,CAAP,EAAxC,EAVF,cAWE,aAXF,cAYE,KAAC,OAAD,EAAS,IAAI,CAAEvB,IAAf,CAAqB,IAAI,CAAED,IAA3B,EAZF,cAaE,6CAAW,sBAAOa,SAAP,EAAX,cAbF,cAcE,YAAK,SAAS,CAAC,aAAf,UAA8BE,MAA9B,EAdF,GADF,CAkBD,C,qBAtHmBtB,KAAK,CAACgB,S,EAyH5Bf,QAAQ,CAAC8C,MAAT,cACE,KAAC,OAAD,IADF,CAEEC,QAAQ,CAACC,cAAT,CAAwB,MAAxB,CAFF","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport shiren2Widths from './json/shiren2.json';\nimport shiren4Widths from './json/shiren4.json';\n\nclass Preview extends React.Component {\n  renderPreview() {\n    let html = [];\n\n    // Shiren 4+ (PSP)\n    if (this.props.game === 'shiren4') {\n      for (const char of this.props.text) {\n        if (char === '\\n') {\n          html.push(`<br/>`);\n          // Lines after the first have 4 spaces of indentation\n          for (let i = 0; i < 4; i++) {\n            html.push(`<img class=\"glyph\" src=\"./font/shiren4/32.png\" />`);\n          }\n        } else {\n          html.push(`<img class=\"glyph\" src=\"./font/shiren4/${char.charCodeAt(0)}.png\" />`);\n        }\n      }\n    }\n\n    return html.join('\\n');\n  }\n\n  render() {\n    if (this.props.game === 'shiren4') {\n      return(\n        <div>\n          <p>Preview:</p>\n          <div className=\"shiren4Preview\" dangerouslySetInnerHTML={{__html: this.renderPreview()}}></div>\n        </div>\n      );\n    } else {\n      return null;\n    }\n  }\n}\n\nclass VWFCalc extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      game: \"\",\n      textArea: \"\",\n      charCount: 0,\n      lookupObj: {},\n      widths: []\n    }\n  }\n\n  handlePresetClick(game) {\n    let lookupObj = {};\n    switch(game) {\n      case 'shiren2':\n        lookupObj = shiren2Widths;\n        break;\n      case 'shiren4':\n        lookupObj = shiren4Widths;\n        break;\n      default:\n        // empty object\n    }\n    this.setState({\n      game: game,\n      lookupObj: lookupObj\n    });\n  }\n\n  handleFileUpload(event) {\n    const reader = new FileReader();\n    reader.readAsText(event.target.files[0], \"UTF-8\");\n    reader.onload = e => {\n      try {\n        this.setState({\n          lookupObj: JSON.parse(e.target.result)\n        });\n      } catch(e) {\n        alert(\"Error parsing widths file.\\n\\nIs it in JSON format?\");\n      }\n    }\n    this.setState({\n      game: \"\"\n    });\n  }\n\n  handleTextAreaChange(event) {\n\n    function calcLineWidth(game, lookupObj, line) {\n      let width = 0;\n      if (game === 'shiren2') {\n        width = 4; // starts with 4 pixels padding\n        for (const char of line) {\n          width += lookupObj[char] + 2; // 2 pixels between each character\n        }\n        if (width > 4) {\n          width -= 2; // last character doesn't have 2 pixels padding\n        } else {\n          width = 0; // set width to 0 if there are no characters\n        }\n      } else {\n        for (const char of line) {\n          width += lookupObj[char];\n        }\n      }\n      return width;\n    }\n    function checkWidthLimit(widths, game, lookupObj) {\n      if (game === 'shiren2') {\n        for (let i = 0; i < widths.length; i++) {\n          if (widths[i] > lookupObj[\"_window\"]) {\n            widths[i] = \"[Too long!]\";\n          }\n        }\n      }\n    }\n    // recalculate widths\n    let lines = event.target.value.split('\\n');\n    let widths = [];\n\n    for (const line of lines) {\n      widths.push( calcLineWidth(this.state.game, this.state.lookupObj, line) );\n    }\n    // Warn for lines that are too long\n    checkWidthLimit(widths, this.state.game, this.state.lookupObj);\n\n    this.setState({\n      textArea: event.target.value,\n      charCount: event.target.value.length,\n      widths: widths\n    });\n  }\n\n  render() {\n    const game = this.state.game;\n    const text = this.state.textArea;\n    const charCount = this.state.charCount;\n    const widths = this.state.widths.join('\\n');\n\n    return (\n      <div>\n        <h4>- Variable Width Font Calculator (v1.0) -</h4>\n        <span>Preset: </span>\n          <button onClick={() => this.handlePresetClick(\"shiren2\")}>Shiren 2</button>\n          <button onClick={() => this.handlePresetClick(\"shiren4\")}>Shiren 4</button>\n          <br/>\n        <span>Custom: </span>\n          <input type=\"file\" onChange={(e) => this.handleFileUpload(e)}></input>\n          <br/>\n          <br/>\n        <textarea cols=\"56\" rows=\"10\" onChange={(e) => this.handleTextAreaChange(e)}></textarea>\n        <br/>\n        <Preview text={text} game={game}/>\n        <p>Result (<span>{charCount}</span> chars):</p>\n        <pre className=\"widthResult\">{widths}</pre>\n      </div>\n    );\n  }\n}\n\nReactDOM.render(\n  <VWFCalc />,\n  document.getElementById('root')\n);\n"]},"metadata":{},"sourceType":"module"}