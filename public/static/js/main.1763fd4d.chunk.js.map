{"version":3,"sources":["index.js"],"names":["Preview","html","this","props","game","text","char","push","i","charCodeAt","join","className","dangerouslySetInnerHTML","__html","renderPreview","React","Component","VWFCalc","state","textArea","charCount","lookupObj","widths","shiren2Widths","shiren4Widths","setState","event","reader","FileReader","readAsText","target","files","onload","e","JSON","parse","result","alert","calcLineWidth","line","width","lines","value","split","length","checkWidthLimit","onClick","handlePresetClick","type","onChange","handleFileUpload","cols","rows","handleTextAreaChange","ReactDOM","render","document","getElementById"],"mappings":"2rBAMMA,E,mKACJ,WACE,IAAIC,EAAO,GAGX,GAAwB,YAApBC,KAAKC,MAAMC,KAAoB,CAAC,IAAD,gBACdF,KAAKC,MAAME,MADG,IACjC,2BAAoC,CAAC,IAA1BC,EAAyB,QAClC,GAAa,OAATA,EAAe,CACjBL,EAAKM,KAAL,SAEA,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IACrBP,EAAKM,KAAL,0DAGFN,EAAKM,KAAL,iDAAoDD,EAAKG,WAAW,GAApE,cAT6B,+BAcnC,OAAOR,EAAKS,KAAK,Q,oBAGnB,WACE,MAAwB,YAApBR,KAAKC,MAAMC,KAEX,gCACE,yCACA,qBAAKO,UAAU,iBAAiBC,wBAAyB,CAACC,OAAQX,KAAKY,sBAIpE,S,GA/BSC,IAAMC,WAoCtBC,E,kDACJ,WAAYd,GAAQ,IAAD,8BACjB,cAAMA,IACDe,MAAQ,CACXd,KAAM,GACNe,SAAU,GACVC,UAAW,EACXC,UAAW,GACXC,OAAQ,IAPO,E,qDAWnB,SAAkBlB,GAChB,IAAIiB,EAAY,GAChB,OAAOjB,GACL,IAAK,UACHiB,EAAYE,EACZ,MACF,IAAK,UACHF,EAAYG,EAKhBtB,KAAKuB,SAAS,CACZrB,KAAMA,EACNiB,UAAWA,M,8BAIf,SAAiBK,GAAQ,IAAD,OAChBC,EAAS,IAAIC,WACnBD,EAAOE,WAAWH,EAAMI,OAAOC,MAAM,GAAI,SACzCJ,EAAOK,OAAS,SAAAC,GACd,IACE,EAAKR,SAAS,CACZJ,UAAWa,KAAKC,MAAMF,EAAEH,OAAOM,UAEjC,MAAMH,GACNI,MAAM,yDAGVnC,KAAKuB,SAAS,CACZrB,KAAM,O,kCAIV,SAAqBsB,GAEnB,SAASY,EAAclC,EAAMiB,EAAWkB,GACtC,IAAIC,EAAQ,EACZ,GAAa,YAATpC,EAAoB,CACtBoC,EAAQ,EADc,oBAEHD,GAFG,IAEtB,2BAAyB,CACvBC,GAASnB,EADc,SACI,GAHP,8BAKlBmB,EAAQ,EACVA,GAAS,EAETA,EAAQ,MAEL,CAAC,IAAD,gBACcD,GADd,IACL,2BAAyB,CACvBC,GAASnB,EADc,UADpB,+BAKP,OAAOmB,EAYT,IA/B0B,EA+BtBC,EAAQf,EAAMI,OAAOY,MAAMC,MAAM,MACjCrB,EAAS,GAhCa,cAkCPmB,GAlCO,IAkC1B,2BAA0B,CAAC,IAAhBF,EAAe,QACxBjB,EAAOf,KAAM+B,EAAcpC,KAAKgB,MAAMd,KAAMF,KAAKgB,MAAMG,UAAWkB,KAnC1C,+BAqB1B,SAAyBjB,EAAQlB,EAAMiB,GACrC,GAAa,YAATjB,EACF,IAAK,IAAII,EAAI,EAAGA,EAAIc,EAAOsB,OAAQpC,IAC7Bc,EAAOd,GAAKa,EAAS,UACvBC,EAAOd,GAAK,eAapBqC,CAAgBvB,EAAQpB,KAAKgB,MAAMd,KAAMF,KAAKgB,MAAMG,WAEpDnB,KAAKuB,SAAS,CACZN,SAAUO,EAAMI,OAAOY,MACvBtB,UAAWM,EAAMI,OAAOY,MAAME,OAC9BtB,OAAQA,M,oBAIZ,WAAU,IAAD,OACDlB,EAAOF,KAAKgB,MAAMd,KAClBC,EAAOH,KAAKgB,MAAMC,SAClBC,EAAYlB,KAAKgB,MAAME,UACvBE,EAASpB,KAAKgB,MAAMI,OAAOZ,KAAK,MAEtC,OACE,gCACE,2EACA,4CACE,wBAAQoC,QAAS,kBAAM,EAAKC,kBAAkB,YAA9C,sBACA,wBAAQD,QAAS,kBAAM,EAAKC,kBAAkB,YAA9C,sBACA,uBACF,4CACE,uBAAOC,KAAK,OAAOC,SAAU,SAAChB,GAAD,OAAO,EAAKiB,iBAAiBjB,MAC1D,uBACA,uBACF,0BAAUkB,KAAK,KAAKC,KAAK,KAAKH,SAAU,SAAChB,GAAD,OAAO,EAAKoB,qBAAqBpB,MACzE,uBACA,cAACjC,EAAD,CAASK,KAAMA,EAAMD,KAAMA,IAC3B,yCAAW,+BAAOgB,IAAlB,cACA,qBAAKT,UAAU,cAAf,SAA8BW,W,GAnHhBP,IAAMC,WAyH5BsC,IAASC,OACP,cAACtC,EAAD,IACAuC,SAASC,eAAe,U","file":"static/js/main.1763fd4d.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport shiren2Widths from './json/shiren2.json';\nimport shiren4Widths from './json/shiren4.json';\n\nclass Preview extends React.Component {\n  renderPreview() {\n    let html = [];\n\n    // Shiren 4+ (PSP)\n    if (this.props.game === 'shiren4') {\n      for (const char of this.props.text) {\n        if (char === '\\n') {\n          html.push(`<br/>`);\n          // Lines after the first have 4 spaces of indentation\n          for (let i = 0; i < 4; i++) {\n            html.push(`<img class=\"glyph\" src=\"./font/shiren4/32.png\" />`);\n          }\n        } else {\n          html.push(`<img class=\"glyph\" src=\"./font/shiren4/${char.charCodeAt(0)}.png\" />`);\n        }\n      }\n    }\n\n    return html.join('\\n');\n  }\n\n  render() {\n    if (this.props.game === 'shiren4') {\n      return(\n        <div>\n          <p>Preview:</p>\n          <div className=\"shiren4Preview\" dangerouslySetInnerHTML={{__html: this.renderPreview()}}></div>\n        </div>\n      );\n    } else {\n      return null;\n    }\n  }\n}\n\nclass VWFCalc extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      game: \"\",\n      textArea: \"\",\n      charCount: 0,\n      lookupObj: {},\n      widths: []\n    }\n  }\n\n  handlePresetClick(game) {\n    let lookupObj = {};\n    switch(game) {\n      case 'shiren2':\n        lookupObj = shiren2Widths;\n        break;\n      case 'shiren4':\n        lookupObj = shiren4Widths;\n        break;\n      default:\n        // empty object\n    }\n    this.setState({\n      game: game,\n      lookupObj: lookupObj\n    });\n  }\n\n  handleFileUpload(event) {\n    const reader = new FileReader();\n    reader.readAsText(event.target.files[0], \"UTF-8\");\n    reader.onload = e => {\n      try {\n        this.setState({\n          lookupObj: JSON.parse(e.target.result)\n        });\n      } catch(e) {\n        alert(\"Error parsing widths file.\\n\\nIs it in JSON format?\");\n      }\n    }\n    this.setState({\n      game: \"\"\n    });\n  }\n\n  handleTextAreaChange(event) {\n\n    function calcLineWidth(game, lookupObj, line) {\n      let width = 0;\n      if (game === 'shiren2') {\n        width = 4; // starts with 4 pixels padding\n        for (const char of line) {\n          width += lookupObj[char] + 2; // 2 pixels between each character\n        }\n        if (width > 4) {\n          width -= 2; // last character doesn't have 2 pixels padding\n        } else {\n          width = 0; // set width to 0 if there are no characters\n        }\n      } else {\n        for (const char of line) {\n          width += lookupObj[char];\n        }\n      }\n      return width;\n    }\n    function checkWidthLimit(widths, game, lookupObj) {\n      if (game === 'shiren2') {\n        for (let i = 0; i < widths.length; i++) {\n          if (widths[i] > lookupObj[\"_window\"]) {\n            widths[i] = \"[Too long!]\";\n          }\n        }\n      }\n    }\n    // recalculate widths\n    let lines = event.target.value.split('\\n');\n    let widths = [];\n\n    for (const line of lines) {\n      widths.push( calcLineWidth(this.state.game, this.state.lookupObj, line) );\n    }\n    // Warn for lines that are too long\n    checkWidthLimit(widths, this.state.game, this.state.lookupObj);\n\n    this.setState({\n      textArea: event.target.value,\n      charCount: event.target.value.length,\n      widths: widths\n    });\n  }\n\n  render() {\n    const game = this.state.game;\n    const text = this.state.textArea;\n    const charCount = this.state.charCount;\n    const widths = this.state.widths.join('\\n');\n\n    return (\n      <div>\n        <h4>- Variable Width Font Calculator (v1.0) -</h4>\n        <span>Preset: </span>\n          <button onClick={() => this.handlePresetClick(\"shiren2\")}>Shiren 2</button>\n          <button onClick={() => this.handlePresetClick(\"shiren4\")}>Shiren 4</button>\n          <br/>\n        <span>Custom: </span>\n          <input type=\"file\" onChange={(e) => this.handleFileUpload(e)}></input>\n          <br/>\n          <br/>\n        <textarea cols=\"56\" rows=\"10\" onChange={(e) => this.handleTextAreaChange(e)}></textarea>\n        <br/>\n        <Preview text={text} game={game}/>\n        <p>Result (<span>{charCount}</span> chars):</p>\n        <pre className=\"widthResult\">{widths}</pre>\n      </div>\n    );\n  }\n}\n\nReactDOM.render(\n  <VWFCalc />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}